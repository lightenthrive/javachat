## kafka和RocketMQ的区别是什么？

- 数据可靠性：

二者在broker和宿主机挂掉一台后，都能保证不丢消息。每条消息都异步刷盘，降低了kafka的性能。

kafka异步刷盘，安全性低。

RocketMQ支持同步刷盘，数据可靠。

- 性能对比：

kafka单机写入小消息100w/s，原因是生产端批量发送，缓存过多会频繁引发gc。kafka的吞吐量在topic和消费端增加后不稳定，超过64后降低。RocketMQ单机写入消息10w/s，适合多topic多消费者的业务，性能稳定，不受topic和消费端数量的营销。RabbitMQ写入速度2w/s。

一个kafka实例上有上百个分区。一个RocketMQ实例上只有一个分区，可以充分利用io组的commit机制，批量发送消息。

- 单机支持的队列数：

Kafka单机超过64个队列/分区，负载增大，消息响应变慢。RocketMQ单机支持最高5万个队列，负载不会发生明显变化。

队列多的好处是：单机可以创建更多话题，因为每个主题都是由一批队列组成。消费者集群规模与队列数成正比。

- 消息投递实时性

Kafka使用短轮询方式，实时性取决于轮询间隔时间，0.8以后版本支持长轮询。高并发时延时。

RocketMQ使用长轮询，同Push方式实时性一致，消息的投递延时通常在几个毫秒。高并发不延时。

- 消费失败重试

kafka消费失败不支持重试。

RocketMQ消费失败支持定时重试，每次重试间隔时间增大。

- 严格的消息顺序

kafka支持消息顺序，但是集群机器添加或者宕机后发生再均衡，就会消费乱序消息。

RocketMQ支持严格的消息顺序，在顺序消息场景下，一台Broker宕机后，发送消息会失败，但是不会乱序。

MySQL的二进制日志分发需要严格的消息顺序，所以可以用RocketMQ做数据管道。

- 定时消息

Kafka不支持定时消息。

RocketMQ支持两类定时消息：

开源版本RocketMQ仅支持定时级别，定时级用户可定制。
阿里云MQ指定的毫秒级别的延时时间。

- 分布式事务消息

Kafka不支持分布式事务消息

阿里云MQ支持分布式事务消息，未来开源版本的RocketMQ也有计划支持分布式事务消息

- 消息查询

Kafka不支持消息查询。

RocketMQ支持根据消息标识或者消息内容来查询消息。可以用于定位消息丢失问题，判断订单处理失败原因。

- 消息回溯

Kafka理论上可以按照偏移来回溯消息。

RocketMQ支持按照时间来回溯消息。

- 消息并行度

Kafka的消费并行度与分区数一致，并且受限于分区数。
RocketMQ消费并行度分两种情况：

顺序消费方式并行度同Kafka完全一致。
乱序方式并行度取决于Consumer的线程数。

- 消息轨迹

Kafka不支持消息轨迹。

阿里云MQ支持消息轨迹。

- 开发语言友好性

Kafka采用scala编写。

RocketMQ采用的Java语言编写。

- 代理端消息过滤

Kafka不支持代理端的消息过滤。

RocketMQ支持两种代理端消息过滤方式

根据消息变量来过滤，相当于子主题概念
向服务器上传一段Java代码，可以对消息做任意形式的过滤，甚至可以做Message身体的过滤拆分。

- 消息堆积能力

理论上Kafka要比RocketMQ的堆积能力更强。RocketMQ单机也可以支持亿级的消息堆积能力。

- 开源社区活跃度

Kafka社区更新较慢。

RocketMQ的GitHub的社区有250个个人，公司用户登记了联系方式，QQ群超过1000人。 

- 商业支持

Kafka原开发团队成立新公司，目前暂没有相关产品看到。

RocketMQ在阿里云已经商业化，目前以云服务形式供大家商用，并向用户承诺99.99%的可靠性，同时彻底解决了用户自己搭建MQ产品的运维复杂性问题。

- 成熟度

Kafka在日志领域比较成熟。

RocketMQ在阿里集团内部有大量的应用在使用，每天都产生海量的消息，并且经历了多次天猫双十一海量消息考验，是数据削峰填谷的利器。

## 消息队列的应用场景有哪些？

## 如何设计一个消息队列？

